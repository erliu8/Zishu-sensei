# å‘é‡æœç´¢æœåŠ¡æ–‡æ¡£

## ğŸ“š æ¦‚è¿°

å‘é‡æœç´¢æœåŠ¡ä½¿ç”¨æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼ˆsentence-transformersï¼‰å’Œå‘é‡æ•°æ®åº“ï¼ˆQdrantï¼‰å®ç°è¯­ä¹‰æœç´¢å’Œå†…å®¹æ¨èã€‚

ä¸ä¼ ç»Ÿçš„å…³é”®è¯æœç´¢ä¸åŒï¼Œå‘é‡æœç´¢èƒ½å¤Ÿç†è§£æ–‡æœ¬çš„è¯­ä¹‰å«ä¹‰ï¼Œæ‰¾åˆ°å†…å®¹ç›¸å…³ä½†ç”¨è¯ä¸åŒçš„ç»“æœã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ–‡æœ¬åµŒå…¥ï¼ˆEmbeddingï¼‰
- ä½¿ç”¨å¤šè¯­è¨€æ¨¡å‹ `paraphrase-multilingual-MiniLM-L12-v2`
- æ”¯æŒä¸­è‹±æ–‡è¯­ä¹‰ç†è§£
- å‘é‡ç»´åº¦ï¼š384ï¼ˆå¯é…ç½®ä¸º768ï¼‰
- è‡ªåŠ¨æ‰¹å¤„ç†ä¼˜åŒ–æ€§èƒ½

### 2. å‘é‡æœç´¢
- è¯­ä¹‰æœç´¢ï¼šç†è§£æŸ¥è¯¢æ„å›¾ï¼Œæ‰¾åˆ°è¯­ä¹‰ç›¸å…³çš„å†…å®¹
- ç›¸ä¼¼åº¦è®¡ç®—ï¼šåŸºäºä½™å¼¦ç›¸ä¼¼åº¦
- çµæ´»è¿‡æ»¤ï¼šæ”¯æŒåˆ†ç±»ã€æ ‡ç­¾ç­‰æ¡ä»¶ç­›é€‰
- æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ Qdrant é«˜æ€§èƒ½å‘é‡æ•°æ®åº“

### 3. å†…å®¹æ¨è
- **ä¸ªæ€§åŒ–æ¨è**ï¼šåŸºäºç”¨æˆ·å†å²è¡Œä¸ºï¼ˆç‚¹èµã€è¯„è®ºï¼‰
- **ç›¸ä¼¼å†…å®¹æ¨è**ï¼šä¸ºæ¯ç¯‡å¸–å­æ¨èç›¸å…³å†…å®¹
- **çƒ­é—¨å†…å®¹**ï¼šåŸºäºäº’åŠ¨æ•°æ®çš„çƒ­åº¦æ’åº
- **æ™ºèƒ½ç¼“å­˜**ï¼šRedis ç¼“å­˜æå‡å“åº”é€Ÿåº¦

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æœç´¢API â”‚ æ¨èAPI   â”‚  ç›¸ä¼¼å†…å®¹API â”‚  çƒ­é—¨API    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Service Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Embedding    â”‚ Vector       â”‚ Recommendation    â”‚   â”‚
â”‚  â”‚ Service      â”‚ Search       â”‚ Service           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL     â”‚    Qdrant        â”‚      Redis       â”‚
â”‚  (å…³ç³»æ•°æ®)      â”‚  (å‘é‡ç´¢å¼•)      â”‚    (ç¼“å­˜)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
app/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ search/
â”‚       â”œâ”€â”€ __init__.py              # æœåŠ¡å¯¼å‡º
â”‚       â”œâ”€â”€ embedding_service.py     # æ–‡æœ¬åµŒå…¥æœåŠ¡
â”‚       â”œâ”€â”€ vector_search.py         # å‘é‡æœç´¢æœåŠ¡
â”‚       â””â”€â”€ recommendation.py        # æ¨èæœåŠ¡
â”œâ”€â”€ api/v1/endpoints/
â”‚   â””â”€â”€ search.py                    # æœç´¢å’Œæ¨è API
â””â”€â”€ db/
    â””â”€â”€ qdrant.py                    # Qdrant æ•°æ®åº“å°è£…

scripts/
â””â”€â”€ manage_vector_index.py           # ç´¢å¼•ç®¡ç†å·¥å…·
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd /opt/zishu-sensei/community_platform/backend
pip install -r requirements.txt
```

ä¸»è¦ä¾èµ–ï¼š
- `sentence-transformers==2.2.2` - æ–‡æœ¬åµŒå…¥æ¨¡å‹
- `qdrant-client==1.7.0` - Qdrant å®¢æˆ·ç«¯
- `torch==2.1.2` - PyTorch æ·±åº¦å­¦ä¹ æ¡†æ¶

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```env
# Qdrant é…ç½®
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_COLLECTION_NAME=zishu_posts
QDRANT_VECTOR_SIZE=384  # ä¸æ¨¡å‹ç»´åº¦ä¸€è‡´
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨ Docker Compose å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æˆ–å•ç‹¬å¯åŠ¨ Qdrant
docker-compose up -d qdrant
```

### 4. åˆå§‹åŒ–ç´¢å¼•

é¦–æ¬¡ä½¿ç”¨éœ€è¦ä¸ºç°æœ‰å¸–å­åˆ›å»ºå‘é‡ç´¢å¼•ï¼š

```bash
# æŸ¥çœ‹ç´¢å¼•çŠ¶æ€
python scripts/manage_vector_index.py status

# é‡æ–°ç´¢å¼•æ‰€æœ‰å¸–å­ï¼ˆé¦–æ¬¡è¿è¡Œå¿…éœ€ï¼‰
python scripts/manage_vector_index.py reindex

# æµ‹è¯•åµŒå…¥æœåŠ¡
python scripts/manage_vector_index.py test-embedding

# æµ‹è¯•æœç´¢
python scripts/manage_vector_index.py search "Pythonç¼–ç¨‹æ•™ç¨‹"
```

## ğŸ“– API ä½¿ç”¨

### 1. å‘é‡æœç´¢ï¼ˆè¯­ä¹‰æœç´¢ï¼‰

```bash
# POST /api/v1/search/vector
curl -X POST "http://localhost:8000/api/v1/search/vector?query=å¦‚ä½•å­¦ä¹ ç¼–ç¨‹&limit=10&score_threshold=0.7"
```

**å‚æ•°ï¼š**
- `query` (å¿…éœ€)ï¼šæœç´¢æŸ¥è¯¢
- `limit` (å¯é€‰ï¼Œé»˜è®¤10)ï¼šè¿”å›æ•°é‡
- `score_threshold` (å¯é€‰ï¼Œé»˜è®¤0.7)ï¼šç›¸ä¼¼åº¦é˜ˆå€¼ (0-1)
- `category` (å¯é€‰)ï¼šåˆ†ç±»ç­›é€‰

**ç‰¹ç‚¹ï¼š**
- ç†è§£è¯­ä¹‰å«ä¹‰ï¼Œå¦‚ "å­¦ä¹ Python" å’Œ "Pythonæ•™ç¨‹" ä¼šåŒ¹é…
- æ”¯æŒä¸­è‹±æ–‡æ··åˆæŸ¥è¯¢
- è‡ªåŠ¨å›é€€åˆ°æ–‡æœ¬æœç´¢ï¼ˆå½“å‘é‡æœç´¢å¤±è´¥æ—¶ï¼‰

### 2. ä¸ªæ€§åŒ–æ¨è

```bash
# GET /api/v1/search/recommendations
curl -H "Authorization: Bearer <token>" \
  "http://localhost:8000/api/v1/search/recommendations?limit=20"
```

**å‚æ•°ï¼š**
- `limit` (å¯é€‰ï¼Œé»˜è®¤20)ï¼šè¿”å›æ•°é‡
- `refresh` (å¯é€‰ï¼Œé»˜è®¤false)ï¼šåˆ·æ–°ç¼“å­˜

**ç‰¹ç‚¹ï¼š**
- åŸºäºç”¨æˆ·ç‚¹èµå’Œè¯„è®ºå†å²
- æ™ºèƒ½æ¨èç›¸ä¼¼å†…å®¹
- 30åˆ†é’Ÿç¼“å­˜

### 3. ç›¸ä¼¼å†…å®¹æ¨è

```bash
# GET /api/v1/search/similar/{post_id}
curl "http://localhost:8000/api/v1/search/similar/123?limit=10"
```

**å‚æ•°ï¼š**
- `post_id` (è·¯å¾„å‚æ•°)ï¼šå¸–å­ ID
- `limit` (å¯é€‰ï¼Œé»˜è®¤10)ï¼šè¿”å›æ•°é‡

**ç‰¹ç‚¹ï¼š**
- æ‰¾åˆ°ä¸»é¢˜ç›¸å…³çš„å¸–å­
- ä¼˜å…ˆæ¨èåŒç±»åˆ«å†…å®¹
- 1å°æ—¶ç¼“å­˜

### 4. çƒ­é—¨å†…å®¹

```bash
# GET /api/v1/search/trending
curl "http://localhost:8000/api/v1/search/trending?limit=20&hours=24"
```

**å‚æ•°ï¼š**
- `limit` (å¯é€‰ï¼Œé»˜è®¤20)ï¼šè¿”å›æ•°é‡
- `hours` (å¯é€‰ï¼Œé»˜è®¤24)ï¼šæ—¶é—´èŒƒå›´ï¼ˆå°æ—¶ï¼‰

**ç‰¹ç‚¹ï¼š**
- çƒ­åº¦è®¡ç®—ï¼šç‚¹èµæ•° Ã— 2 + è¯„è®ºæ•° Ã— 3 + æµè§ˆæ•° Ã— 0.1
- å¯è‡ªå®šä¹‰æ—¶é—´èŒƒå›´
- 15åˆ†é’Ÿç¼“å­˜

## ğŸ› ï¸ ç´¢å¼•ç®¡ç†

### ç®¡ç†å·¥å…·å‘½ä»¤

```bash
# æŸ¥çœ‹ç´¢å¼•çŠ¶æ€
python scripts/manage_vector_index.py status

# é‡æ–°ç´¢å¼•æ‰€æœ‰å¸–å­
python scripts/manage_vector_index.py reindex

# ç´¢å¼•å•ä¸ªå¸–å­
python scripts/manage_vector_index.py index 123

# åˆ é™¤å¸–å­ç´¢å¼•
python scripts/manage_vector_index.py delete 123

# æµ‹è¯•æœç´¢
python scripts/manage_vector_index.py search "äººå·¥æ™ºèƒ½åº”ç”¨"

# æµ‹è¯•åµŒå…¥æœåŠ¡
python scripts/manage_vector_index.py test-embedding
```

### è‡ªåŠ¨ç´¢å¼•

å¸–å­çš„åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å‘é‡ç´¢å¼•ï¼š

```python
from app.services.search import get_vector_search_service

# åœ¨å¸–å­åˆ›å»ºå
await vector_service.index_post(post)

# åœ¨å¸–å­æ›´æ–°å
await vector_service.update_post_index(post)

# åœ¨å¸–å­åˆ é™¤å
await vector_service.delete_post_index(post.id)
```

## âš™ï¸ é…ç½®ä¼˜åŒ–

### 1. æ¨¡å‹é€‰æ‹©

åœ¨ `embedding_service.py` ä¸­å¯æ›´æ”¹æ¨¡å‹ï¼š

```python
# é»˜è®¤ï¼šå¤šè¯­è¨€å°å‹æ¨¡å‹ï¼ˆæ¨èï¼‰
model_name = "paraphrase-multilingual-MiniLM-L12-v2"  # 384ç»´

# å¤‡é€‰ï¼šæ›´å¤§çš„å¤šè¯­è¨€æ¨¡å‹ï¼ˆæ›´å‡†ç¡®ä½†æ›´æ…¢ï¼‰
model_name = "distiluse-base-multilingual-cased-v1"  # 512ç»´

# è‹±æ–‡ä¸“ç”¨ï¼ˆæ›´å¿«ï¼‰
model_name = "all-MiniLM-L6-v2"  # 384ç»´
```

**æ³¨æ„ï¼š** æ›´æ”¹æ¨¡å‹åéœ€è¦ï¼š
1. æ›´æ–° `QDRANT_VECTOR_SIZE` é…ç½®
2. é‡æ–°åˆ›å»º Qdrant é›†åˆ
3. é‡æ–°ç´¢å¼•æ‰€æœ‰å¸–å­

### 2. æ‰¹å¤„ç†ä¼˜åŒ–

```python
# æ‰¹é‡ç´¢å¼•æ—¶è°ƒæ•´æ‰¹å¤„ç†å¤§å°
success_count = await vector_service.batch_index_posts(
    posts, 
    batch_size=50  # æ ¹æ®å†…å­˜å’ŒCPUè°ƒæ•´
)
```

### 3. ç›¸ä¼¼åº¦é˜ˆå€¼

```python
# è¾ƒé«˜é˜ˆå€¼ (0.8-1.0)ï¼šæ›´ç²¾ç¡®ï¼Œç»“æœè¾ƒå°‘
# ä¸­ç­‰é˜ˆå€¼ (0.6-0.8)ï¼šå¹³è¡¡ç²¾ç¡®åº¦å’Œå¬å›ç‡ï¼ˆæ¨èï¼‰
# è¾ƒä½é˜ˆå€¼ (0.4-0.6)ï¼šæ›´å®½æ³›ï¼Œç»“æœæ›´å¤š

results = await vector_service.search_similar_posts(
    query=query,
    score_threshold=0.7  # é»˜è®¤å€¼
)
```

### 4. ç¼“å­˜ç­–ç•¥

åœ¨ `recommendation.py` ä¸­è°ƒæ•´ç¼“å­˜æ—¶é—´ï¼š

```python
# ä¸ªæ€§åŒ–æ¨èç¼“å­˜ï¼š30åˆ†é’Ÿ
await self.redis.set_json(cache_key, post_ids, expire=1800)

# ç›¸ä¼¼å¸–å­ç¼“å­˜ï¼š1å°æ—¶
await self.redis.set_json(cache_key, cache_data, expire=3600)

# çƒ­é—¨å¸–å­ç¼“å­˜ï¼š15åˆ†é’Ÿ
await self.redis.set_json(cache_key, post_ids, expire=900)
```

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### Python æµ‹è¯•

```python
import asyncio
from app.services.search import embed_text, get_vector_search_service
from app.db.session import async_session_maker

async def test_vector_search():
    # æµ‹è¯•æ–‡æœ¬åµŒå…¥
    vector = await embed_text("å¦‚ä½•å­¦ä¹  Python ç¼–ç¨‹ï¼Ÿ")
    print(f"å‘é‡ç»´åº¦: {len(vector)}")
    
    # æµ‹è¯•å‘é‡æœç´¢
    async with async_session_maker() as db:
        service = get_vector_search_service(db)
        results = await service.search_similar_posts(
            query="Python æ•™ç¨‹",
            limit=5,
        )
        
        for post, score in results:
            print(f"[{score:.3f}] {post.title}")

asyncio.run(test_vector_search())
```

### cURL æµ‹è¯•

```bash
# 1. æ³¨å†Œç”¨æˆ·
curl -X POST "http://localhost:8000/api/v1/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123"
  }'

# 2. ç™»å½•è·å– token
TOKEN=$(curl -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "password123"}' \
  | jq -r '.access_token')

# 3. æµ‹è¯•å‘é‡æœç´¢
curl -X POST "http://localhost:8000/api/v1/search/vector?query=ç¼–ç¨‹å­¦ä¹ " \
  -H "Authorization: Bearer $TOKEN"

# 4. æµ‹è¯•ä¸ªæ€§åŒ–æ¨è
curl "http://localhost:8000/api/v1/search/recommendations" \
  -H "Authorization: Bearer $TOKEN"
```

## ğŸ” å·¥ä½œåŸç†

### å‘é‡æœç´¢æµç¨‹

```
1. ç”¨æˆ·è¾“å…¥æŸ¥è¯¢ "å¦‚ä½•å­¦ä¹ Python"
   â†“
2. è½¬æ¢ä¸º384ç»´å‘é‡ [0.12, -0.45, 0.78, ...]
   â†“
3. åœ¨ Qdrant ä¸­æœç´¢ç›¸ä¼¼å‘é‡ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
   â†“
4. è¿”å›ç›¸ä¼¼åº¦ > 0.7 çš„å¸–å­
   â†“
5. ä» PostgreSQL åŠ è½½å¸–å­è¯¦æƒ…
   â†“
6. è¿”å›æœç´¢ç»“æœ
```

### ä¸ªæ€§åŒ–æ¨èæµç¨‹

```
1. è·å–ç”¨æˆ·æœ€è¿‘ç‚¹èµ/è¯„è®ºçš„å¸–å­
   â†“
2. ä¸ºæ¯ä¸ªå¸–å­æ‰¾ç›¸ä¼¼å†…å®¹
   â†“
3. åˆå¹¶å»é‡æ¨èç»“æœ
   â†“
4. å¦‚æœä¸è¶³ï¼Œè¡¥å……çƒ­é—¨å†…å®¹
   â†“
5. ç¼“å­˜30åˆ†é’Ÿ
   â†“
6. è¿”å›æ¨èåˆ—è¡¨
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´ï¼ˆå‚è€ƒå€¼ï¼‰

- **æ–‡æœ¬åµŒå…¥**ï¼š50-200msï¼ˆå•ä¸ªæ–‡æœ¬ï¼‰
- **å‘é‡æœç´¢**ï¼š10-50msï¼ˆQdrantæŸ¥è¯¢ï¼‰
- **æ•°æ®åº“æŸ¥è¯¢**ï¼š20-100msï¼ˆPostgreSQLï¼‰
- **æ€»ä½“å“åº”**ï¼š100-400ms

### ç´¢å¼•é€Ÿåº¦

- **å•ä¸ªå¸–å­**ï¼š~100ms
- **æ‰¹é‡ç´¢å¼•ï¼ˆ50ä¸ªï¼‰**ï¼š~3-5ç§’
- **1000ä¸ªå¸–å­**ï¼š~1-2åˆ†é’Ÿ

### å‡†ç¡®æ€§

- **ä¸­æ–‡è¯­ä¹‰ç†è§£**ï¼šä¼˜ç§€
- **è‹±æ–‡è¯­ä¹‰ç†è§£**ï¼šä¼˜ç§€
- **ä¸­è‹±æ··åˆ**ï¼šè‰¯å¥½
- **ç›¸ä¼¼åº¦é˜ˆå€¼å»ºè®®**ï¼š0.6-0.8

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. æ¨¡å‹ä¸‹è½½æ…¢

é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹ï¼ˆ~120MBï¼‰ï¼Œå¯èƒ½è¾ƒæ…¢ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# é¢„å…ˆä¸‹è½½æ¨¡å‹
python -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('paraphrase-multilingual-MiniLM-L12-v2')"
```

### 2. å†…å­˜ä¸è¶³

å‘é‡æœç´¢éœ€è¦è¾ƒå¤šå†…å­˜ï¼Œç‰¹åˆ«æ˜¯ PyTorchã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
- å‡å°æ‰¹å¤„ç†å¤§å°
- ä½¿ç”¨æ›´å°çš„æ¨¡å‹
- å¢åŠ ç³»ç»Ÿå†…å­˜æˆ–ä½¿ç”¨ GPU

### 3. æœç´¢ç»“æœä¸ç›¸å…³

ç›¸ä¼¼åº¦é˜ˆå€¼å¯èƒ½è®¾ç½®ä¸å½“ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
```python
# æé«˜é˜ˆå€¼ä»¥è·å¾—æ›´ç²¾ç¡®çš„ç»“æœ
score_threshold=0.8  # è€Œä¸æ˜¯ 0.5
```

### 4. ç´¢å¼•å¤±è´¥

æ£€æŸ¥ Qdrant æœåŠ¡æ˜¯å¦è¿è¡Œã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥ Qdrant çŠ¶æ€
docker-compose ps qdrant

# é‡å¯ Qdrant
docker-compose restart qdrant
```

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### å®šæœŸç»´æŠ¤ä»»åŠ¡

```bash
# 1. æ¯å‘¨é‡æ–°ç´¢å¼•ï¼ˆå¯é€‰ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼‰
python scripts/manage_vector_index.py reindex

# 2. ç›‘æ§ç´¢å¼•çŠ¶æ€
python scripts/manage_vector_index.py status

# 3. æ¸…ç† Redis ç¼“å­˜ï¼ˆå¦‚éœ€ï¼‰
docker-compose exec redis redis-cli FLUSHDB
```

### å‡çº§æ¨¡å‹

```bash
# 1. ä¿®æ”¹ embedding_service.py ä¸­çš„æ¨¡å‹åç§°
# 2. æ›´æ–°å‘é‡ç»´åº¦é…ç½®
# 3. åˆ é™¤æ—§é›†åˆï¼ˆQdrant UI: http://localhost:6333/dashboardï¼‰
# 4. é‡æ–°ç´¢å¼•
python scripts/manage_vector_index.py reindex
```

## ğŸ“š å‚è€ƒèµ„æº

- [Sentence Transformers æ–‡æ¡£](https://www.sbert.net/)
- [Qdrant æ–‡æ¡£](https://qdrant.tech/documentation/)
- [å‘é‡æœç´¢æœ€ä½³å®è·µ](https://www.pinecone.io/learn/vector-search/)

---

**åˆ›å»ºæ—¶é—´**: 2025-10-22  
**ç‰ˆæœ¬**: 1.0.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

