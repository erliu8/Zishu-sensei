# ğŸ”’ åˆ†æ”¯ä¿æŠ¤è§„åˆ™é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä¸º Zishu ç¤¾åŒºå¹³å°å‰ç«¯é¡¹ç›®é…ç½®åˆ†æ”¯ä¿æŠ¤è§„åˆ™ã€‚

---

## ä¸»è¦åˆ†æ”¯ä¿æŠ¤è§„åˆ™

### `main` åˆ†æ”¯ï¼ˆç”Ÿäº§åˆ†æ”¯ï¼‰

#### åŸºæœ¬è®¾ç½®
- âœ… **è¦æ±‚ PR æ‰èƒ½åˆå¹¶** - ä¸å…è®¸ç›´æ¥æ¨é€
- âœ… **è¦æ±‚å®¡æŸ¥** - è‡³å°‘éœ€è¦ 1 äººå®¡æŸ¥æ‰¹å‡†
- âœ… **è§£æ•£è¿‡æ—¶å®¡æŸ¥** - æ–°æäº¤æ—¶é‡æ–°å®¡æŸ¥
- âœ… **è¦æ±‚ä»£ç æ‰€æœ‰è€…å®¡æŸ¥** - å…³é”®æ–‡ä»¶éœ€è¦ CODEOWNERS å®¡æŸ¥
- âœ… **é™åˆ¶å®¡æŸ¥è€…** - åªæœ‰å›¢é˜Ÿæˆå‘˜å¯ä»¥å®¡æŸ¥

#### çŠ¶æ€æ£€æŸ¥
å¿…é¡»é€šè¿‡ä»¥ä¸‹ CI æ£€æŸ¥æ‰èƒ½åˆå¹¶ï¼š
- âœ… `ci / lint` - ä»£ç è§„èŒƒæ£€æŸ¥
- âœ… `ci / typecheck` - TypeScript ç±»å‹æ£€æŸ¥
- âœ… `ci / test` - å•å…ƒæµ‹è¯•
- âœ… `ci / build` - æ„å»ºæµ‹è¯•
- âœ… `ci / security` - å®‰å…¨æ£€æŸ¥
- âœ… `test / e2e-test` - E2E æµ‹è¯•ï¼ˆè‡³å°‘ä¸€ä¸ªæµè§ˆå™¨ï¼‰

#### é¢å¤–é™åˆ¶
- âœ… **è¦æ±‚åˆ†æ”¯æœ€æ–°** - å¿…é¡»åŸºäºæœ€æ–°çš„ main åˆ†æ”¯
- âœ… **è¦æ±‚ç­¾åæäº¤** - æ‰€æœ‰æäº¤å¿…é¡»ç»è¿‡ GPG ç­¾åï¼ˆæ¨èï¼‰
- âœ… **åŒ…æ‹¬ç®¡ç†å‘˜** - è§„åˆ™å¯¹ç®¡ç†å‘˜ä¹Ÿç”Ÿæ•ˆ
- âœ… **é™åˆ¶å¼ºåˆ¶æ¨é€** - ç¦æ­¢å¼ºåˆ¶æ¨é€
- âœ… **é™åˆ¶åˆ é™¤** - ç¦æ­¢åˆ é™¤åˆ†æ”¯

#### å…è®¸çš„åˆå¹¶ç±»å‹
- âœ… **Squash merging** - æ¨èï¼Œä¿æŒæäº¤å†å²æ•´æ´
- âœ… **Rebase merging** - ä¿æŒçº¿æ€§å†å²
- âŒ **Merge commits** - ä¸æ¨èï¼Œä¼šäº§ç”Ÿåˆå¹¶æäº¤

---

### `develop` åˆ†æ”¯ï¼ˆå¼€å‘åˆ†æ”¯ï¼‰

#### åŸºæœ¬è®¾ç½®
- âœ… **è¦æ±‚ PR æ‰èƒ½åˆå¹¶** - ä¸å…è®¸ç›´æ¥æ¨é€
- âœ… **è¦æ±‚å®¡æŸ¥** - è‡³å°‘éœ€è¦ 1 äººå®¡æŸ¥æ‰¹å‡†
- âœ… **è§£æ•£è¿‡æ—¶å®¡æŸ¥** - æ–°æäº¤æ—¶é‡æ–°å®¡æŸ¥
- âŒ **è¦æ±‚ä»£ç æ‰€æœ‰è€…å®¡æŸ¥** - å¼€å‘åˆ†æ”¯ä¸å¼ºåˆ¶è¦æ±‚

#### çŠ¶æ€æ£€æŸ¥
å¿…é¡»é€šè¿‡ä»¥ä¸‹ CI æ£€æŸ¥æ‰èƒ½åˆå¹¶ï¼š
- âœ… `ci / lint` - ä»£ç è§„èŒƒæ£€æŸ¥
- âœ… `ci / typecheck` - TypeScript ç±»å‹æ£€æŸ¥
- âœ… `ci / test` - å•å…ƒæµ‹è¯•
- âœ… `ci / build` - æ„å»ºæµ‹è¯•

#### é¢å¤–é™åˆ¶
- âœ… **è¦æ±‚åˆ†æ”¯æœ€æ–°** - å¿…é¡»åŸºäºæœ€æ–°çš„ develop åˆ†æ”¯
- âŒ **è¦æ±‚ç­¾åæäº¤** - å¯é€‰
- âœ… **åŒ…æ‹¬ç®¡ç†å‘˜** - è§„åˆ™å¯¹ç®¡ç†å‘˜ä¹Ÿç”Ÿæ•ˆ
- âœ… **é™åˆ¶å¼ºåˆ¶æ¨é€** - ç¦æ­¢å¼ºåˆ¶æ¨é€
- âŒ **é™åˆ¶åˆ é™¤** - å…è®¸åˆ é™¤ï¼ˆè°¨æ…æ“ä½œï¼‰

---

### `release/*` åˆ†æ”¯ï¼ˆå‘å¸ƒåˆ†æ”¯ï¼‰

#### åŸºæœ¬è®¾ç½®
- âœ… **è¦æ±‚ PR æ‰èƒ½åˆå¹¶**
- âœ… **è¦æ±‚å®¡æŸ¥** - è‡³å°‘éœ€è¦ 2 äººå®¡æŸ¥æ‰¹å‡†ï¼ˆæ›´ä¸¥æ ¼ï¼‰
- âœ… **è§£æ•£è¿‡æ—¶å®¡æŸ¥**
- âœ… **è¦æ±‚ä»£ç æ‰€æœ‰è€…å®¡æŸ¥**

#### çŠ¶æ€æ£€æŸ¥
å¿…é¡»é€šè¿‡æ‰€æœ‰ CI æ£€æŸ¥ï¼š
- âœ… `ci / lint`
- âœ… `ci / typecheck`
- âœ… `ci / test`
- âœ… `ci / build`
- âœ… `ci / security`
- âœ… `test / e2e-test`ï¼ˆæ‰€æœ‰æµè§ˆå™¨ï¼‰
- âœ… `test / performance-test`

---

## é…ç½®æ­¥éª¤

### é€šè¿‡ GitHub Web ç•Œé¢é…ç½®

1. **è¿›å…¥ä»“åº“è®¾ç½®**
   ```
   Repository -> Settings -> Branches
   ```

2. **æ·»åŠ åˆ†æ”¯ä¿æŠ¤è§„åˆ™**
   - ç‚¹å‡» "Add branch protection rule"
   - åœ¨ "Branch name pattern" ä¸­è¾“å…¥åˆ†æ”¯åç§°ï¼ˆå¦‚ `main`ï¼‰

3. **é…ç½®ä¿æŠ¤è§„åˆ™**
   - æ ¹æ®ä¸Šè¿°è§„åˆ™å‹¾é€‰ç›¸åº”é€‰é¡¹
   - æ·»åŠ å¿…éœ€çš„çŠ¶æ€æ£€æŸ¥
   - è®¾ç½®å®¡æŸ¥è¦æ±‚

4. **ä¿å­˜è§„åˆ™**
   - ç‚¹å‡» "Create" æˆ– "Save changes"

### é€šè¿‡ GitHub CLI é…ç½®

```bash
# å®‰è£… GitHub CLI
# https://cli.github.com/

# ç™»å½•
gh auth login

# ä¸º main åˆ†æ”¯æ·»åŠ ä¿æŠ¤è§„åˆ™
gh api repos/:owner/:repo/branches/main/protection \
  --method PUT \
  --field required_status_checks='{"strict":true,"contexts":["ci / lint","ci / typecheck","ci / test","ci / build","ci / security"]}' \
  --field enforce_admins=true \
  --field required_pull_request_reviews='{"required_approving_review_count":1,"dismiss_stale_reviews":true,"require_code_owner_reviews":true}' \
  --field restrictions=null
```

### é€šè¿‡ Terraform é…ç½®

```hcl
# terraform/github_branch_protection.tf

resource "github_branch_protection" "main" {
  repository_id = github_repository.repo.node_id
  pattern       = "main"

  required_status_checks {
    strict = true
    contexts = [
      "ci / lint",
      "ci / typecheck",
      "ci / test",
      "ci / build",
      "ci / security",
      "test / e2e-test"
    ]
  }

  required_pull_request_reviews {
    required_approving_review_count = 1
    dismiss_stale_reviews           = true
    require_code_owner_reviews      = true
  }

  enforce_admins              = true
  require_signed_commits      = true
  require_conversation_resolution = true
  
  restrict_pushes {
    blocks_creations = false
  }
}
```

---

## CODEOWNERS æ–‡ä»¶

åˆ›å»º `.github/CODEOWNERS` æ–‡ä»¶æ¥æŒ‡å®šä»£ç æ‰€æœ‰è€…ï¼š

```
# å…¨å±€æ‰€æœ‰è€…ï¼ˆé»˜è®¤ï¼‰
* @zishu-team/frontend-leads

# æ ¸å¿ƒé…ç½®æ–‡ä»¶
package.json @zishu-team/tech-leads
tsconfig.json @zishu-team/tech-leads
next.config.ts @zishu-team/tech-leads

# CI/CD é…ç½®
.github/workflows/* @zishu-team/devops @zishu-team/tech-leads

# åŸºç¡€è®¾æ–½ä»£ç 
src/infrastructure/* @zishu-team/senior-engineers

# å®‰å…¨ç›¸å…³
src/features/auth/* @zishu-team/security @zishu-team/senior-engineers

# æ–‡æ¡£
docs/* @zishu-team/tech-leads
*.md @zishu-team/tech-leads

# æµ‹è¯•
__tests__/* @zishu-team/qa
*.test.ts @zishu-team/qa
*.test.tsx @zishu-team/qa
```

---

## åˆ†æ”¯å‘½åè§„èŒƒ

### åŠŸèƒ½åˆ†æ”¯
```
feature/<issue-number>-<short-description>
ç¤ºä¾‹: feature/123-add-user-authentication
```

### Bug ä¿®å¤åˆ†æ”¯
```
fix/<issue-number>-<short-description>
ç¤ºä¾‹: fix/456-login-button-not-working
```

### çƒ­ä¿®å¤åˆ†æ”¯
```
hotfix/<issue-number>-<short-description>
ç¤ºä¾‹: hotfix/789-critical-security-patch
```

### å‘å¸ƒåˆ†æ”¯
```
release/<version>
ç¤ºä¾‹: release/v1.2.0
```

### æ–‡æ¡£åˆ†æ”¯
```
docs/<description>
ç¤ºä¾‹: docs/update-readme
```

### é‡æ„åˆ†æ”¯
```
refactor/<description>
ç¤ºä¾‹: refactor/improve-auth-service
```

---

## åˆå¹¶ç­–ç•¥

### ä» feature åˆ° develop
- **åˆå¹¶æ–¹å¼**: Squash and Merge
- **å®¡æŸ¥è¦æ±‚**: è‡³å°‘ 1 äºº
- **CI è¦æ±‚**: å…¨éƒ¨é€šè¿‡

### ä» develop åˆ° main
- **åˆå¹¶æ–¹å¼**: Merge Commitï¼ˆä¿ç•™å®Œæ•´å†å²ï¼‰
- **å®¡æŸ¥è¦æ±‚**: è‡³å°‘ 2 äºº
- **CI è¦æ±‚**: å…¨éƒ¨é€šè¿‡ï¼ˆåŒ…æ‹¬ E2Eï¼‰
- **é¢å¤–è¦æ±‚**: 
  - æ›´æ–° CHANGELOG
  - æ›´æ–°ç‰ˆæœ¬å·
  - é€šè¿‡æµ‹è¯•ç¯å¢ƒéªŒè¯

### ä» hotfix åˆ° main
- **åˆå¹¶æ–¹å¼**: Merge Commit
- **å®¡æŸ¥è¦æ±‚**: è‡³å°‘ 2 äººï¼ˆåŒ…æ‹¬æŠ€æœ¯è´Ÿè´£äººï¼‰
- **CI è¦æ±‚**: å…¨éƒ¨é€šè¿‡
- **é¢å¤–è¦æ±‚**: 
  - å¿…é¡»æœ‰ issue è¿½è¸ª
  - å¿…é¡»æœ‰å›æ»šè®¡åˆ’

---

## è‡ªåŠ¨åŒ–æ£€æŸ¥æ¸…å•

### PR æäº¤æ—¶è‡ªåŠ¨æ£€æŸ¥
- [ ] åˆ†æ”¯åç§°ç¬¦åˆè§„èŒƒ
- [ ] PR æ ‡é¢˜ç¬¦åˆè§„èŒƒï¼ˆConventional Commitsï¼‰
- [ ] PR æè¿°å®Œæ•´
- [ ] å…³è”äº† Issue
- [ ] æ‰€æœ‰ CI æ£€æŸ¥é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡ â‰¥ 80%
- [ ] æ²¡æœ‰æ–°å¢ TypeScript é”™è¯¯
- [ ] æ²¡æœ‰ ESLint é”™è¯¯
- [ ] æ„å»ºæˆåŠŸ

### åˆå¹¶å‰äººå·¥æ£€æŸ¥
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ— å†²çª
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] CHANGELOG å·²æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰

---

## ç´§æ€¥æƒ…å†µå¤„ç†

### ç»•è¿‡ä¿æŠ¤è§„åˆ™
åªæœ‰åœ¨ä»¥ä¸‹ç´§æ€¥æƒ…å†µä¸‹æ‰è€ƒè™‘ï¼š
1. ç”Ÿäº§ç¯å¢ƒä¸¥é‡æ•…éšœ
2. å®‰å…¨æ¼æ´ç´§æ€¥ä¿®å¤
3. å…³é”®ä¸šåŠ¡åŠŸèƒ½ä¸­æ–­

**æµç¨‹**ï¼š
1. åˆ›å»ºç´§æ€¥é—®é¢˜ Issue
2. é€šçŸ¥å›¢é˜Ÿè´Ÿè´£äºº
3. è·å¾—æŠ€æœ¯è´Ÿè´£äººæ‰¹å‡†
4. è®°å½•æ“ä½œæ—¥å¿—
5. äº‹åå¤ç›˜

---

## ç›‘æ§å’Œå®¡è®¡

### å®šæœŸæ£€æŸ¥
- **æ¯å‘¨**: æ£€æŸ¥è¢«æ‹’ç»çš„ PR åŸå› 
- **æ¯æœˆ**: å®¡æŸ¥åˆ†æ”¯ä¿æŠ¤è§„åˆ™æ˜¯å¦éœ€è¦è°ƒæ•´
- **æ¯å­£åº¦**: è¯„ä¼°è§„åˆ™æœ‰æ•ˆæ€§

### ç›‘æ§æŒ‡æ ‡
- PR å¹³å‡å®¡æŸ¥æ—¶é—´
- CI æ£€æŸ¥å¤±è´¥ç‡
- åˆå¹¶å bug å‘ç°ç‡
- å›æ»šæ¬¡æ•°

---

## å‚è€ƒèµ„æº

- [GitHub Branch Protection](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches)
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Git Flow](https://nvie.com/posts/a-successful-git-branching-model/)

---

**ç»´æŠ¤è€…**: DevOps Team  
**æœ€åæ›´æ–°**: 2025-10-23

