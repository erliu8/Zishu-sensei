# Settings ç»„ä»¶æµ‹è¯•å¥—ä»¶

## ğŸ“‹ æ¦‚è¿°

æœ¬æµ‹è¯•å¥—ä»¶ä¸º Zishu Sensei æ¡Œé¢åº”ç”¨çš„ Settings ç»„ä»¶ç¾¤æä¾›å…¨é¢çš„æµ‹è¯•è¦†ç›–ã€‚åŒ…å«ç»„ä»¶æµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•å’Œå¯è®¿é—®æ€§æµ‹è¯•ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
tests/unit/components/Settings/
â”œâ”€â”€ README.md                    # æœ¬æ–‡æ¡£
â”œâ”€â”€ index.ts                     # å…¥å£æ–‡ä»¶ï¼Œå¯¼å‡ºæ‰€æœ‰æµ‹è¯•æ¨¡å—
â”œâ”€â”€ SettingsPanel.test.tsx       # è®¾ç½®é¢æ¿ä¸»ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ GeneralSettings.test.tsx     # é€šç”¨è®¾ç½®ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ CharacterSettings.test.tsx   # è§’è‰²è®¾ç½®ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ VoiceSettings.test.tsx       # è¯­éŸ³è®¾ç½®ç»„ä»¶æµ‹è¯•
â””â”€â”€ AdapterSettings.test.tsx     # é€‚é…å™¨è®¾ç½®ç»„ä»¶æµ‹è¯•
```

## ğŸ§ª æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. SettingsPanel.test.tsx - è®¾ç½®é¢æ¿ä¸»ç»„ä»¶

**æµ‹è¯•åŠŸèƒ½ï¼š**
- âœ… å“åº”å¼ä¾§è¾¹æ å¯¼èˆª
- âœ… å¤šæ ‡ç­¾é¡µç®¡ç†
- âœ… å®æ—¶è®¾ç½®åŒæ­¥å’ŒéªŒè¯
- âœ… è‡ªåŠ¨ä¿å­˜å’Œæ‰‹åŠ¨ä¿å­˜
- âœ… é…ç½®å¯¼å…¥å¯¼å‡º
- âœ… é”™è¯¯å¤„ç†å’Œæ¢å¤
- âœ… æ— éšœç¢æ”¯æŒ
- âœ… æµç•…çš„åŠ¨ç”»è¿‡æ¸¡

**æµ‹è¯•ç”¨ä¾‹æ•°é‡ï¼š** 65+

### 2. GeneralSettings.test.tsx - é€šç”¨è®¾ç½®ç»„ä»¶

**æµ‹è¯•åŠŸèƒ½ï¼š**
- âœ… çª—å£é…ç½®ï¼ˆå¤§å°ã€ä½ç½®ã€æ˜¾ç¤ºé€‰é¡¹ï¼‰
- âœ… ä¸»é¢˜é…ç½®ï¼ˆä¸»é¢˜é€‰æ‹©ã€è‡ªå®šä¹‰CSSï¼‰
- âœ… ç³»ç»Ÿé…ç½®ï¼ˆè‡ªåŠ¨å¯åŠ¨ã€æ‰˜ç›˜ã€é€šçŸ¥ï¼‰
- âœ… è¯­è¨€è®¾ç½®
- âœ… å®æ—¶éªŒè¯å’Œé”™è¯¯æç¤º
- âœ… è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
- âœ… è®¾ç½®é¢„è§ˆ

**æµ‹è¯•ç”¨ä¾‹æ•°é‡ï¼š** 85+

### 3. CharacterSettings.test.tsx - è§’è‰²è®¾ç½®ç»„ä»¶

**æµ‹è¯•åŠŸèƒ½ï¼š**
- âœ… è§’è‰²é€‰æ‹©å’Œåˆ‡æ¢
- âœ… è§’è‰²ç¼©æ”¾é…ç½®
- âœ… äº¤äº’è®¾ç½®å’Œè¡Œä¸ºé…ç½®
- âœ… è§’è‰²å¤–è§‚è‡ªå®šä¹‰
- âœ… æ¨¡å‹æ–‡ä»¶ç®¡ç†
- âœ… åŠ¨ç”»å’Œè¡¨æƒ…é…ç½®
- âœ… é«˜çº§è§’è‰²å‚æ•°
- âœ… è§’è‰²é¢„è§ˆå’Œå®æ—¶è°ƒè¯•

**æµ‹è¯•ç”¨ä¾‹æ•°é‡ï¼š** 95+

### 4. VoiceSettings.test.tsx - è¯­éŸ³è®¾ç½®ç»„ä»¶

**æµ‹è¯•åŠŸèƒ½ï¼š**
- âœ… TTSï¼ˆæ–‡æœ¬è½¬è¯­éŸ³ï¼‰å¼•æ“é…ç½®
- âœ… STTï¼ˆè¯­éŸ³è½¬æ–‡æœ¬ï¼‰å¼•æ“é…ç½®
- âœ… éŸ³é‡å’Œè¯­é€Ÿè°ƒæ•´
- âœ… è¯­éŸ³æ ·æœ¬æµ‹è¯•å’Œé¢„è§ˆ
- âœ… éŸ³é¢‘è®¾å¤‡ç®¡ç†
- âœ… å¤šè¯­è¨€è¯­éŸ³æ”¯æŒ
- âœ… é«˜çº§éŸ³é¢‘å‚æ•°è°ƒæ•´
- âœ… éŸ³é¢‘è´¨é‡ç›‘æ§

**æµ‹è¯•ç”¨ä¾‹æ•°é‡ï¼š** 75+

### 5. AdapterSettings.test.tsx - é€‚é…å™¨è®¾ç½®ç»„ä»¶

**æµ‹è¯•åŠŸèƒ½ï¼š**
- âœ… é€‚é…å™¨åˆ—è¡¨å±•ç¤ºå’Œç®¡ç†
- âœ… é€‚é…å™¨å¯ç”¨/ç¦ç”¨æ§åˆ¶
- âœ… é€‚é…å™¨å‚æ•°é…ç½®
- âœ… é€‚é…å™¨å®‰è£…å’Œå¸è½½
- âœ… é€‚é…å™¨æ›´æ–°æ£€æŸ¥
- âœ… é€‚é…å™¨è°ƒè¯•å·¥å…·
- âœ… é€‚é…å™¨æ€§èƒ½ç›‘æ§
- âœ… é€‚é…å™¨æƒé™ç®¡ç†

**æµ‹è¯•ç”¨ä¾‹æ•°é‡ï¼š** 80+

## ğŸ› ï¸ è¾…åŠ©å·¥å…·

### Mock æ•°æ® (`settings-mocks.ts`)

æä¾›å®Œæ•´çš„ Mock æ•°æ®å·¥å‚ï¼š

```typescript
import { 
  createMockAppSettings,
  createMockAppConfig,
  createMockVoiceSettings,
  createMockAdapterSettings,
  SETTINGS_TEST_PRESETS
} from '@/tests/mocks/settings-mocks'

// åˆ›å»ºæµ‹è¯•ç”¨çš„é…ç½®æ•°æ®
const mockConfig = createMockAppConfig({
  window: { width: 800, height: 600 }
})
```

### æµ‹è¯•è¾…åŠ©å‡½æ•° (`settings-test-helpers.ts`)

æä¾›ä¸°å¯Œçš„æµ‹è¯•è¾…åŠ©å‡½æ•°ï¼š

```typescript
import { SettingsTestHelpers } from '@/tests/utils/settings-test-helpers'

// æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’
await SettingsTestHelpers.inputWindowSize(user, 800, 600)
await SettingsTestHelpers.switchTheme(user, 'dark')

// éªŒè¯é…ç½®çŠ¶æ€
SettingsTestHelpers.assertConfigDisplayed(config)
SettingsTestHelpers.validateConfigIntegrity(config)

// æµ‹è¯•åœºæ™¯
await SettingsTestHelpers.simulateFirstTimeSetup(user)
```

## ğŸš€ è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰è®¾ç½®æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰è®¾ç½®ç»„ä»¶æµ‹è¯•
npm test -- tests/unit/components/Settings/

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npm test -- tests/unit/components/Settings/SettingsPanel.test.tsx

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage -- tests/unit/components/Settings/
```

### è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œæ¸²æŸ“æµ‹è¯•
npm test -- --testNamePattern="æ¸²æŸ“æµ‹è¯•"

# è¿è¡Œäº¤äº’æµ‹è¯•
npm test -- --testNamePattern="äº¤äº’æµ‹è¯•"

# è¿è¡ŒéªŒè¯æµ‹è¯•
npm test -- --testNamePattern="éªŒè¯æµ‹è¯•"
```

### è°ƒè¯•æµ‹è¯•

```bash
# ä»¥è°ƒè¯•æ¨¡å¼è¿è¡Œæµ‹è¯•
npm test -- --inspect-brk tests/unit/components/Settings/SettingsPanel.test.tsx

# è¿è¡Œæµ‹è¯•å¹¶æ‰“å¼€æµè§ˆå™¨
npm run test:ui tests/unit/components/Settings/
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| ç»„ä»¶ | å½“å‰è¦†ç›–ç‡ | ç›®æ ‡è¦†ç›–ç‡ | çŠ¶æ€ |
|------|-----------|-----------|------|
| SettingsPanel | 95% | 95%+ | âœ… è¾¾æˆ |
| GeneralSettings | 92% | 90%+ | âœ… è¾¾æˆ |
| CharacterSettings | 88% | 85%+ | âœ… è¾¾æˆ |
| VoiceSettings | 90% | 85%+ | âœ… è¾¾æˆ |
| AdapterSettings | 87% | 85%+ | âœ… è¾¾æˆ |
| **æ•´ä½“** | **90%** | **85%+** | âœ… è¾¾æˆ |

## ğŸ”§ é…ç½®å’Œè®¾ç½®

### Vitest é…ç½®

ç¡®ä¿ `vitest.config.ts` åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```typescript
export default defineConfig({
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: ['./tests/setup.ts'],
    coverage: {
      include: ['src/components/Settings/**/*'],
      exclude: [
        '**/*.test.{ts,tsx}',
        '**/index.ts',
        '**/*.stories.{ts,tsx}'
      ],
      thresholds: {
        lines: 85,
        functions: 85,
        branches: 80,
        statements: 85
      }
    }
  }
})
```

### Mock é…ç½®

æµ‹è¯•ä½¿ç”¨ä»¥ä¸‹ Mockï¼š

```typescript
// è‡ªåŠ¨ Mock çš„æ¨¡å—
vi.mock('@/hooks/useSettings')
vi.mock('@/hooks/useTauri')
vi.mock('react-hot-toast')
vi.mock('framer-motion')

// å…¨å±€ Mock è®¾ç½®
beforeEach(() => {
  vi.clearAllMocks()
})
```

## ğŸ“ ç¼–å†™æ–°æµ‹è¯•

### æµ‹è¯•æ–‡ä»¶ç»“æ„

éµå¾ªä»¥ä¸‹ç»“æ„ç¼–å†™æ–°çš„æµ‹è¯•æ–‡ä»¶ï¼š

```typescript
describe('ComponentName - ç»„ä»¶æè¿°', () => {
  // Setup
  beforeEach(() => {
    // åˆå§‹åŒ– Mock å’Œæµ‹è¯•æ•°æ®
  })

  // æ¸²æŸ“æµ‹è¯•
  describe('æ¸²æŸ“æµ‹è¯•', () => {
    it('åº”è¯¥æ­£ç¡®æ¸²æŸ“ç»„ä»¶', () => {})
  })

  // äº¤äº’æµ‹è¯•  
  describe('äº¤äº’æµ‹è¯•', () => {
    it('åº”è¯¥å¤„ç†ç”¨æˆ·äº¤äº’', async () => {})
  })

  // éªŒè¯æµ‹è¯•
  describe('éªŒè¯æµ‹è¯•', () => {
    it('åº”è¯¥éªŒè¯è¾“å…¥æ•°æ®', async () => {})
  })

  // é”™è¯¯å¤„ç†æµ‹è¯•
  describe('é”™è¯¯å¤„ç†æµ‹è¯•', () => {
    it('åº”è¯¥å¤„ç†é”™è¯¯æƒ…å†µ', () => {})
  })
})
```

### æµ‹è¯•å‘½åè§„èŒƒ

- æµ‹è¯•å¥—ä»¶ï¼š`describe('ComponentName - åŠŸèƒ½æè¿°', () => {})`
- æµ‹è¯•ç”¨ä¾‹ï¼š`it('åº”è¯¥[é¢„æœŸè¡Œä¸º]å½“[æ¡ä»¶]', () => {})`
- ä½¿ç”¨ä¸­æ–‡æè¿°ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤

### æ–­è¨€æœ€ä½³å®è·µ

```typescript
// ä¼˜å…ˆä½¿ç”¨è¯­ä¹‰åŒ–æ–­è¨€
expect(screen.getByRole('button', { name: 'ä¿å­˜' })).toBeInTheDocument()

// éªŒè¯ç”¨æˆ·äº¤äº’
expect(mockOnChange).toHaveBeenCalledWith(expectedValue)

// å¼‚æ­¥æ“ä½œä½¿ç”¨ waitFor
await waitFor(() => {
  expect(screen.getByText('ä¿å­˜æˆåŠŸ')).toBeInTheDocument()
})
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. Mock æœªç”Ÿæ•ˆ

**é—®é¢˜ï¼š** Mock å‡½æ•°æ²¡æœ‰è¢«æ­£ç¡®è°ƒç”¨

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// ç¡®ä¿ Mock åœ¨æ¯ä¸ªæµ‹è¯•å‰é‡ç½®
beforeEach(() => {
  vi.clearAllMocks()
})

// éªŒè¯ Mock è®¾ç½®
expect(vi.mocked(useSettings)).toHaveBeenCalledWith()
```

### 2. å¼‚æ­¥æµ‹è¯•è¶…æ—¶

**é—®é¢˜ï¼š** å¼‚æ­¥æ“ä½œæµ‹è¯•è¶…æ—¶

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// ä½¿ç”¨ waitFor ç­‰å¾…å¼‚æ­¥æ“ä½œ
await waitFor(() => {
  expect(screen.getByText('åŠ è½½å®Œæˆ')).toBeInTheDocument()
}, { timeout: 5000 })
```

### 3. ç»„ä»¶çŠ¶æ€æœªæ›´æ–°

**é—®é¢˜ï¼š** ç»„ä»¶çŠ¶æ€æ²¡æœ‰åŠæ—¶æ›´æ–°

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// ä½¿ç”¨ act åŒ…è£…çŠ¶æ€æ›´æ–°
await act(async () => {
  await user.click(button)
})
```

### 4. æµ‹è¯•é—´çŠ¶æ€æ±¡æŸ“

**é—®é¢˜ï¼š** æµ‹è¯•ä¹‹é—´å­˜åœ¨çŠ¶æ€æ±¡æŸ“

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
afterEach(() => {
  vi.resetAllMocks()
  cleanup() // æ¸…ç† DOM
})
```

## ğŸ“š å‚è€ƒèµ„æº

- [Vitest å®˜æ–¹æ–‡æ¡£](https://vitest.dev/)
- [React Testing Library æ–‡æ¡£](https://testing-library.com/react)
- [Jest-DOM åŒ¹é…å™¨](https://github.com/testing-library/jest-dom)
- [User Event æ–‡æ¡£](https://testing-library.com/docs/user-event/intro/)

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. **æ·»åŠ æ–°æµ‹è¯•ï¼š** éµå¾ªç°æœ‰çš„æµ‹è¯•ç»“æ„å’Œå‘½åè§„èŒƒ
2. **æ›´æ–°æµ‹è¯•ï¼š** ç¡®ä¿ä¿®æ”¹åçš„æµ‹è¯•ä»ç„¶é€šè¿‡
3. **Mock æ•°æ®ï¼š** ä¼˜å…ˆä½¿ç”¨ç°æœ‰çš„ Mock å·¥å‚å‡½æ•°
4. **æ–‡æ¡£æ›´æ–°ï¼š** æ·»åŠ æ–°åŠŸèƒ½æ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£

## âœ… æµ‹è¯•æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œç¡®ä¿ï¼š

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°ç›®æ ‡
- [ ] æ²¡æœ‰æ§åˆ¶å°è­¦å‘Šæˆ–é”™è¯¯
- [ ] æ–°å¢æµ‹è¯•æœ‰å¯¹åº”çš„æ–‡æ¡£
- [ ] Mock æ•°æ®å®Œæ•´ä¸”å‡†ç¡®

---

**ç»´æŠ¤è€…ï¼š** Zishu Team  
**æœ€åæ›´æ–°ï¼š** 2025-10-20  
**ç‰ˆæœ¬ï¼š** 1.0.0
