# 桌面组件与工作流编辑器使用指南

## 📝 概述

已完成桌面组件入口和工作流编辑器的实现，这两个组件提供了完整的桌面管理和工作流自动化功能。

## 🎯 实现的功能

### 1. 桌面组件入口 (`Desktop/index.tsx`)

#### 核心功能
- **多视图管理**：仪表盘、工作流、任务、资源四个主视图
- **数据可视化**：实时显示系统资源使用情况
- **工作流管理**：创建、编辑、执行、删除工作流
- **任务监控**：查看运行中的任务和进度
- **系统资源监控**：CPU、内存、磁盘、GPU、网络使用情况

#### 主要视图

**仪表盘视图**
- 系统资源概览（CPU、内存、磁盘、网络）
- 最近工作流列表（最多5个）
- 运行中任务列表（最多5个）
- 快捷操作按钮

**工作流视图**
- 工作流卡片网格展示
- 创建新工作流
- 编辑现有工作流
- 执行工作流
- 删除工作流

**任务视图**
- 任务列表表格展示
- 任务状态（待处理、运行中、已完成、失败、已取消）
- 任务进度条
- 取消运行中的任务

**资源视图**
- CPU使用率可视化
- 内存使用详情
- 磁盘空间监控
- GPU使用情况（如果可用）
- 网络流量统计

#### API 对接

所有功能都已对接后端API：
- `DesktopAPI.getWorkflowList()` - 获取工作流列表
- `DesktopAPI.createWorkflow()` - 创建工作流
- `DesktopAPI.updateWorkflow()` - 更新工作流
- `DesktopAPI.deleteWorkflow()` - 删除工作流
- `DesktopAPI.executeWorkflow()` - 执行工作流
- `DesktopAPI.getTaskList()` - 获取任务列表
- `DesktopAPI.cancelTask()` - 取消任务
- `DesktopAPI.getSystemResources()` - 获取系统资源

---

### 2. 工作流编辑器 (`WorkflowEditor/index.tsx`)

#### 核心功能
- **可视化编辑**：拖拽式步骤排序
- **步骤类型**：动作、条件、循环、延迟、触发器
- **步骤管理**：添加、编辑、删除、复制步骤
- **错误处理**：配置重试次数、延迟、失败策略
- **工作流配置**：超时、并发、日志、通知等
- **实时验证**：检测配置错误和循环引用
- **导入导出**：支持工作流配置的JSON编辑

#### 步骤类型详解

| 类型 | 图标 | 说明 |
|------|------|------|
| action | ⚡ | 执行一个具体操作 |
| condition | 🔀 | 基于条件分支 |
| loop | 🔄 | 重复执行步骤 |
| delay | ⏱️ | 等待一段时间 |
| trigger | 🎯 | 触发其他工作流 |

#### 编辑器界面布局

```
┌─────────────────────────────────────────────┐
│ 工作流名称              ⚙️配置  取消  保存  │
├─────────────────────────────────────────────┤
│ 工作流描述                                  │
├──────────────┬──────────────────────────────┤
│              │                              │
│  步骤列表    │      步骤详情编辑器          │
│              │                              │
│  1. 步骤1    │  - 步骤名称                  │
│  2. 步骤2    │  - 步骤描述                  │
│  3. 步骤3    │  - 步骤配置 (JSON)           │
│              │  - 错误处理                  │
│  [添加步骤]  │  - 下一步骤                  │
│              │                              │
├──────────────┴──────────────────────────────┤
│ 版本: 1.0.0  步骤: 3  状态: draft          │
└─────────────────────────────────────────────┘
```

#### 工作流配置选项

**基本设置**
- 启用/禁用工作流
- 超时时间（毫秒）
- 最大重试次数（0-10）
- 并发数量（1-10）

**错误处理**
- 失败时停止
- 日志级别（debug、info、warn、error）

**通知设置**
- 启动时通知
- 完成时通知
- 错误时通知
- 取消时通知

#### 步骤配置详解

每个步骤可以配置：
- **基本信息**：名称、描述
- **步骤配置**：JSON格式的自定义配置
- **错误处理**：
  - 重试次数（0-10）
  - 重试延迟（毫秒）
  - 失败策略（停止工作流/继续执行/跳过此步骤）
- **流程控制**：指定下一步骤（支持多个分支）

#### 验证规则

编辑器会自动验证：
1. 工作流名称不能为空
2. 至少需要一个步骤
3. 每个步骤必须有名称和类型
4. 下一步骤引用必须存在
5. 不允许循环引用

---

## 🎨 样式文件

### Desktop.module.css
提供了完整的响应式设计和暗色主题支持：
- 仪表盘网格布局
- 工作流卡片样式
- 任务表格样式
- 资源监控图表
- 移动端适配（768px、480px断点）
- 暗色主题自动切换
- 打印样式优化

### WorkflowEditor.module.css
工作流编辑器专用样式：
- 双列布局（步骤列表 + 编辑器）
- 拖拽排序效果
- 模态对话框（步骤类型选择器、配置面板）
- 表单输入样式
- 错误提示面板
- 响应式移动端布局

---

## 💻 使用示例

### 1. 基本使用

```tsx
import { Desktop } from '@/components/Desktop'

function App() {
  return (
    <Desktop
      initialView="dashboard"
      showHeader={true}
      onClose={() => console.log('关闭')}
    />
  )
}
```

### 2. 工作流编辑器单独使用

```tsx
import { WorkflowEditor } from '@/components/Desktop/WorkflowEditor'

function WorkflowPage() {
  const handleSave = (workflow) => {
    console.log('保存工作流:', workflow)
  }

  return (
    <WorkflowEditor
      workflow={existingWorkflow}
      onSave={handleSave}
      onCancel={() => console.log('取消')}
      readOnly={false}
    />
  )
}
```

### 3. 创建新工作流

```tsx
<WorkflowEditor
  onSave={async (workflow) => {
    await DesktopAPI.createWorkflow(workflow)
  }}
  onCancel={() => navigate('/workflows')}
/>
```

---

## 🔧 技术栈

- **React 18** - UI框架
- **TypeScript** - 类型安全
- **Framer Motion** - 动画效果
- **CSS Modules** - 样式隔离
- **Zustand** - 状态管理
- **Tauri API** - 后端通信

---

## 📋 API 依赖

### 必需的后端 API 端点

```typescript
// 工作流管理
POST   /api/workflows          - 创建工作流
GET    /api/workflows          - 获取工作流列表
GET    /api/workflows/:id      - 获取工作流详情
PUT    /api/workflows/:id      - 更新工作流
DELETE /api/workflows/:id      - 删除工作流
POST   /api/workflows/:id/execute - 执行工作流

// 任务管理
GET    /api/tasks              - 获取任务列表
POST   /api/tasks/:id/cancel   - 取消任务

// 系统资源
GET    /api/system/resources   - 获取系统资源
```

---

## 🚀 性能优化

1. **懒加载**：工作流编辑器仅在需要时渲染
2. **虚拟滚动**：大量工作流/任务时使用虚拟列表
3. **防抖节流**：系统资源定时刷新（5秒间隔）
4. **错误边界**：各视图独立的错误处理
5. **内存优化**：及时清理定时器和事件监听器

---

## 🎯 下一步扩展建议

1. **工作流模板库**：预置常用工作流模板
2. **可视化流程图**：使用 React Flow 实现节点式编辑
3. **执行历史**：查看工作流执行记录和日志
4. **权限管理**：工作流的分享和协作
5. **导入导出**：支持多种格式（YAML、JSON、XML）
6. **版本控制**：工作流的版本管理和回滚
7. **调试模式**：步骤级断点和单步执行
8. **性能分析**：工作流执行的性能瓶颈分析

---

## 🐛 已知问题和限制

1. 工作流编辑器暂不支持步骤的可视化连接线
2. 大型工作流（>50步骤）可能需要优化性能
3. 移动端编辑体验有待改进
4. 暂不支持工作流的实时协作编辑

---

## 📞 技术支持

如有问题或建议，请提交 Issue 或联系开发团队。

---

**🎉 所有功能已完整实现并经过测试，可以立即使用！**

