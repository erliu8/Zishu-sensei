{
  "id": "chat-workflow-001",
  "name": "AI Chat Processing Workflow",
  "description": "Complete workflow for processing chat messages with AI",
  "version": "2.0.0",
  "status": "published",
  "steps": [
    {
      "id": "step-validate",
      "name": "Validate Input",
      "step_type": "condition",
      "order": 0,
      "config": {
        "condition": "{{message.length}} > 0",
        "true_branch": ["step-preprocess"],
        "false_branch": ["step-error"]
      },
      "retry_config": {
        "max_retries": 0,
        "retry_delay_ms": 0,
        "backoff_multiplier": 1.0
      },
      "timeout_seconds": 5,
      "enabled": true
    },
    {
      "id": "step-preprocess",
      "name": "Preprocess Message",
      "step_type": "transform",
      "order": 1,
      "config": {
        "operations": [
          "trim_whitespace",
          "normalize_unicode",
          "detect_language"
        ],
        "output_variable": "processed_message"
      },
      "dependencies": ["step-validate"],
      "retry_config": {
        "max_retries": 2,
        "retry_delay_ms": 500,
        "backoff_multiplier": 1.5
      },
      "timeout_seconds": 10,
      "enabled": true
    },
    {
      "id": "step-adapter-call",
      "name": "Call AI Adapter",
      "step_type": "api_call",
      "order": 2,
      "config": {
        "adapter_id": "openai-gpt4",
        "endpoint": "/v1/chat/completions",
        "method": "POST",
        "payload": {
          "messages": [
            {
              "role": "user",
              "content": "{{processed_message}}"
            }
          ],
          "temperature": 0.7,
          "max_tokens": 2048
        },
        "output_variable": "ai_response"
      },
      "dependencies": ["step-preprocess"],
      "retry_config": {
        "max_retries": 3,
        "retry_delay_ms": 2000,
        "backoff_multiplier": 2.0
      },
      "timeout_seconds": 60,
      "enabled": true
    },
    {
      "id": "step-postprocess",
      "name": "Postprocess Response",
      "step_type": "transform",
      "order": 3,
      "config": {
        "operations": [
          "format_markdown",
          "add_metadata",
          "sanitize_output"
        ],
        "output_variable": "final_response"
      },
      "dependencies": ["step-adapter-call"],
      "retry_config": {
        "max_retries": 1,
        "retry_delay_ms": 500,
        "backoff_multiplier": 1.0
      },
      "timeout_seconds": 10,
      "enabled": true
    },
    {
      "id": "step-save",
      "name": "Save to Database",
      "step_type": "database",
      "order": 4,
      "config": {
        "table": "chat_history",
        "operation": "insert",
        "data": {
          "user_message": "{{processed_message}}",
          "ai_response": "{{final_response}}",
          "timestamp": "{{current_timestamp}}",
          "adapter_id": "{{adapter_id}}"
        }
      },
      "dependencies": ["step-postprocess"],
      "retry_config": {
        "max_retries": 3,
        "retry_delay_ms": 1000,
        "backoff_multiplier": 1.5
      },
      "timeout_seconds": 15,
      "enabled": true
    },
    {
      "id": "step-return",
      "name": "Return Response",
      "step_type": "output",
      "order": 5,
      "config": {
        "message": "{{final_response}}",
        "format": "json"
      },
      "dependencies": ["step-save"],
      "retry_config": {
        "max_retries": 0,
        "retry_delay_ms": 0,
        "backoff_multiplier": 1.0
      },
      "timeout_seconds": 5,
      "enabled": true
    },
    {
      "id": "step-error",
      "name": "Handle Error",
      "step_type": "output",
      "order": 99,
      "config": {
        "message": "Error: Invalid input message",
        "error_code": "INVALID_INPUT"
      },
      "retry_config": {
        "max_retries": 0,
        "retry_delay_ms": 0,
        "backoff_multiplier": 1.0
      },
      "timeout_seconds": 5,
      "enabled": true
    }
  ],
  "config": {
    "timeout_seconds": 120,
    "max_retries": 3,
    "retry_delay_ms": 2000,
    "parallel_execution": false,
    "error_handling": "continue_on_error",
    "logging_enabled": true,
    "telemetry_enabled": true
  },
  "trigger": {
    "trigger_type": "event",
    "config": {
      "event_name": "chat_message_received",
      "filter": {
        "source": "user"
      }
    }
  },
  "tags": ["chat", "ai", "complex", "production"],
  "category": "ai_processing",
  "is_template": false,
  "template_id": null,
  "created_at": 1704067200,
  "updated_at": 1707782400
}

