# AI聊天功能使用指南

## 功能概述

现在你可以在桌面助手中使用AI聊天功能，通过选择不同的角色模板与AI进行对话。

## 新增功能

### 1. 角色选择器
- **位置**: 聊天窗口输入框上方
- **功能**: 选择不同的角色模板进行对话
- **设计**: 类似Claude的模型选择器UI风格

### 2. 真实AI对话
- 集成后端API，实现真正的AI对话功能
- 支持会话管理（session_id）
- 支持角色模板和适配器

### 3. 角色切换
- 可以在对话过程中切换不同的角色
- 每个角色有独立的提示词和LLM配置

## 使用方法

### 步骤1: 创建角色模板

在使用聊天功能之前，需要先创建角色模板：

1. 打开应用右键菜单
2. 选择"适配器管理"
3. 点击"创建角色模板"
4. 填写角色信息：
   - 角色名称
   - 角色描述
   - Live2D模型
   - Prompt配置
   - LLM配置（本地模型或API）

### 步骤2: 开始对话

1. 打开聊天窗口（右键菜单 -> 打开对话）
2. 在输入框上方点击角色选择器
3. 从下拉菜单中选择一个角色模板
4. 输入消息并发送

### 步骤3: 切换角色

随时可以点击角色选择器切换到其他角色：
- 不同角色会有不同的对话风格
- 每个角色使用独立的提示词和配置

## 功能特性

### 角色选择器特性

- ✅ 显示所有可用的角色模板
- ✅ 实时加载角色列表
- ✅ 显示角色详细信息（名称、描述、Prompt、LLM配置）
- ✅ 当前选中角色高亮显示
- ✅ 点击外部自动关闭下拉菜单
- ✅ 响应式设计

### AI对话特性

- ✅ 真实的AI API调用
- ✅ 会话管理（保持对话上下文）
- ✅ 加载状态提示
- ✅ 错误处理和提示
- ✅ 自动滚动到最新消息
- ✅ 角色验证（未选择角色时提示）

## 技术实现

### 组件结构

```
ChatWindow.tsx          # 聊天窗口主组件
├── CharacterSelector   # 角色选择器组件
└── ChatService         # 聊天服务（API调用）
```

### API集成

发送消息时会传递以下参数：
```typescript
{
  message: string,              // 用户消息
  session_id: string,           // 会话ID
  character_id: string,         // 角色模板ID
  adapter: string,              // 适配器ID（可选）
}
```

### 状态管理

- `selectedCharacterId`: 当前选中的角色ID
- `sessionId`: 会话ID（在组件创建时生成）
- `isLoading`: 发送消息的加载状态
- `messages`: 消息列表

## 注意事项

1. **后端服务**: 确保后端服务正常运行，否则消息发送会失败
2. **角色模板**: 至少需要创建一个角色模板才能使用聊天功能
3. **网络连接**: 如果使用API模式的LLM，需要稳定的网络连接
4. **适配器**: 确保角色模板的适配器已正确注册

## 故障排查

### 问题1: 角色列表为空
**解决方案**: 
- 检查是否已创建角色模板
- 打开适配器管理页面创建新的角色模板

### 问题2: 消息发送失败
**可能原因**:
- 后端服务未启动
- 网络连接问题（API模式）
- 适配器未正确配置

**解决方案**:
- 检查后端服务状态
- 查看控制台错误日志
- 验证角色模板配置

### 问题3: 角色选择器无法打开
**解决方案**:
- 刷新页面
- 检查浏览器控制台是否有错误

## 未来规划

- [ ] 支持流式响应（实时显示AI回复）
- [ ] 聊天历史记录持久化
- [ ] 多会话管理
- [ ] 消息搜索功能
- [ ] 导出对话记录
- [ ] 语音输入/输出
- [ ] 多模态支持（图片、文件等）

## 反馈

如有问题或建议，请提交Issue或Pull Request。
