<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zishu Sensei - AIæ¡Œé¢å® ç‰©åŠ©æ‰‹</title>
    <!-- Live2D Cubism 4 Core è¿è¡Œæ—¶ - å¿…é¡»åœ¨å…¶ä»– Live2D ä»£ç ä¹‹å‰åŠ è½½ -->
    <script src="/live2d/live2dcubismcore.min.js"></script>
    
    <!-- PixiJS BatchRenderer ä¿®å¤ - å¿…é¡»åœ¨ PixiJS åŠ è½½å‰æ‰§è¡Œ -->
    <script>
        // å…¨å±€ PixiJS ä¿®å¤è„šæœ¬
        (function() {
            // ç›‘å¬æ¨¡å—åŠ è½½ï¼Œåœ¨ PixiJS åŠ è½½æ—¶ç«‹å³ä¿®å¤
            const originalDefine = window.define;
            const originalRequire = window.require;
            
            // åˆ›å»ºä¸€ä¸ªä¿®å¤å‡½æ•°
            function fixPixiJSBatchRenderer(pixiModule) {
                try {
                    if (pixiModule && pixiModule.BatchRenderer) {
                        const BatchRenderer = pixiModule.BatchRenderer;
                        const originalMethod = BatchRenderer.prototype.checkMaxIfStatementsInShader;
                        
                        if (originalMethod && !originalMethod._isFixed) {
                            BatchRenderer.prototype.checkMaxIfStatementsInShader = function(maxIfs) {
                                const safeMaxIfs = Math.max(maxIfs || 32, 32);
                                console.log('ğŸ”§ PixiJS BatchRenderer å…¨å±€ä¿®å¤:', maxIfs, '->', safeMaxIfs);
                                return originalMethod.call(this, safeMaxIfs);
                            };
                            BatchRenderer.prototype.checkMaxIfStatementsInShader._isFixed = true;
                            console.log('âœ… PixiJS BatchRenderer å…¨å±€ä¿®å¤å®Œæˆ');
                            return true;
                        }
                    }
                } catch (error) {
                    console.warn('âš ï¸ PixiJS å…¨å±€ä¿®å¤å¤±è´¥:', error);
                }
                return false;
            }
            
            // å°è¯•é€šè¿‡å…¨å±€å¯¹è±¡ä¿®å¤
            function tryGlobalFix() {
                if (window.PIXI) {
                    return fixPixiJSBatchRenderer(window.PIXI);
                }
                return false;
            }
            
            // ç«‹å³å°è¯•ä¿®å¤
            tryGlobalFix();
            
            // ç›‘å¬ PIXI å…¨å±€å¯¹è±¡çš„åˆ›å»º
            let pixiCheckInterval = setInterval(() => {
                if (tryGlobalFix()) {
                    clearInterval(pixiCheckInterval);
                }
            }, 10);
            
            // 10ç§’ååœæ­¢æ£€æŸ¥
            setTimeout(() => {
                if (pixiCheckInterval) {
                    clearInterval(pixiCheckInterval);
                }
            }, 10000);
            
        })();
    </script>
</head>

<body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
</body>

</html>
